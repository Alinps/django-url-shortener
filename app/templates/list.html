<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  {%load static%}
  <title>Your Links ‚Äî Shortly</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{%static 'css/list.css'%}">
  <link rel="stylesheet" href="{%static 'css/navbar.css'%}">
  <link rel="stylesheet" href="{%static 'css/footer.css'%}">
</head>
<body>
{%include 'partials/navbar.html'%}
<main class="page">

  <!-- HEADER -->
  <section class="page-header">
    <h1 class="gradient-text">Your Shortened Links</h1>
    <p class="subtitle">
      Manage, monitor, and track the performance of your shortened URLs.
    </p>
      
      <div class="search-wrapper">
{#            <button id="searchToggle" class="search-btn">#}
{#                üîç Search#}
{#            </button>#}

            <form method="get" id="searchForm" class="search-form">
                <label>
                    <input
                        type="text"
                        name="q"
                        placeholder="Search by title, short link or URL‚Ä¶"
                        value="{{ request.GET.q }}"
                        />
                </label>
                <ul id="suggestions" class="suggestions"></ul>
            </form>
      </div>
  </section>

  <!-- STATS -->
  <section class="stats">
    <div class="stat-card">
      <span class="label">Total Links</span>
      <span class="value" id="total_urls">{{total_urls}}</span>
    </div>
    <div class="stat-card">
      <span class="label">Active Links</span>
      <span class="value green" id="active_urls">{{active_urls}}</span>
    </div>
    <div class="stat-card">
      <span class="label">Disabled Links</span>
      <span class="value red" style="color:red;" id="disabled_urls">{{disabled_urls}}</span>
    </div>
    <div class="stat-card">
      <span class="label">Total Clicks</span>
      <span class="value">{{total_clicks}}</span>
    </div>
<a href="{%url 'home'%}">
    <div class="stat-card">
      <span class="label">Create new Short Link ‚ûï </span>
      <span class="value"></span>
    </div>
</a>
  </section>
    {% if urls %}
      <table class="url-table">
        <thead>
          <tr>
            <th>Short Link</th>
            <th>Title</th>
            <th>Original URL</th>
            <th>Clicks</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody id="url-table-body">

          {% for url in urls %}
          <tr id="row-{{ url.id }}">

            <!-- Short link -->
            <td data-label="Short Link">
              <a href="{% url 'redirect' url.short_code %}">
                {{ url.short_code }}
              </a>
            </td>

            <!-- Title -->
            <td data-label="Title" class="title">{{ url.title }}</td>

            <!-- Original URL -->
            <td  data-label="Original URL"  class="original">
              {{ url.original_url }}
            </td>

            <!-- Click count -->
            <td  data-label="Clicks">{{ url.click_count }}</td>

            <!-- Status pill -->
            <td data-label="Status">
              <span class="status status-pill {% if url.is_active %}active{% else %}disabled{% endif %}">
                {% if url.is_active %}Active{% else %}Disabled{% endif %}
              </span>
            </td>

            <!-- Actions -->
            <td  data-label="Actions">
              <!-- Toggle -->
              <span class="tooltip">
                <a href="{% url 'toggle' url.id %}"
                   class="icon-btn {% if url.is_active %}active{% endif %}">
                  ‚èª
                </a>
                <span class="tooltip-text">Activate / Disable</span>
              </span>

              <!-- Edit -->
              <span class="tooltip">
               <a onclick="openEdit('{{ url.id }}','{{ url.title }}','{{ url.original_url }}')" class="icon-btn edit">
                   üìù
               </a>

                <span class="tooltip-text">Edit</span>
              </span>

              <!-- Delete -->
              <span class="tooltip">
               <a onclick="openDelete('{{ url.id }}')" class="icon-btn delete">üóë</a>

                <span class="tooltip-text">Delete</span>
              </span>

              <!-- Copy -->
              <span class="tooltip">
                <a class="icon-btn link"
                   data-url="{{ request.scheme }}://{{ request.get_host }}/redirect/{{ url.short_code }}"
                   onclick="copyToClipboard(this)">
                  üîó
                </a>
                <span class="tooltip-text">Copy URL</span>
              </span>
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
        <p>No link to show.</p>
    {% endif %}




 <div class="pagination">
  {% if urls.has_previous %}
    <a class="page-btn prev" href="?page={{ urls.previous_page_number }}">‚Üê Previous</a>
  {% else %}
    <span class="page-btn disabled">‚Üê Previous</span>
  {% endif %}

  <span class="page-info">
    Page {{ urls.number }} of {{ urls.paginator.num_pages }}
  </span>

  {% if urls.has_next %}
    <a class="page-btn next" href="?page={{ urls.next_page_number }}">Next ‚Üí</a>
  {% else %}
    <span class="page-btn disabled">Next ‚Üí</span>
  {% endif %}
</div>


  <!-- FOOTNOTE -->
  <section class="note">
    <p>
      Tip: Keep your links organized by monitoring inactive URLs and tracking click trends.
    </p>
  </section>

</main>

<!--edit modal--->
<div class="modal-overlay" id="editModal">
  <div class="modal-card">
    <h2>Edit URL</h2>

    <form id="editForm">
      {% csrf_token %}
      <input type="hidden" id="edit-id">

      <div class="field">
        <label>Title</label>
        <input type="text" id="edit-title">
      </div>

      <div class="field">
        <label>Original URL</label>
        <input type="url" id="edit-url">
      </div>

{#       <div class="field">#}
{#            <label>Status</label>#}
{#            <select id="edit-status">#}
{#                <option value="true">Active</option>#}
{#                <option value="false">Disabled</option>#}
{#            </select>#}
{#       </div>#}

      <div class="modal-actions">
        <button type="button" class="btn btn-cancel" onclick="closeEdit()">Cancel</button>
        <button type="submit" class="btn btn-save">Save</button>
      </div>
    </form>
  </div>
</div>


<!--delete modal-->
<div class="modal-overlay" id="deleteModal">
  <div class="modal-card danger">
    <h2>Delete URL?</h2>
    <p>This action cannot be undone.</p>

    <div class="modal-actions">
      <button class="btn modal-ghost" onclick="closeDelete()">Cancel</button>
      <button class="btn modal-danger" onclick="confirmDelete()">Delete</button>
    </div>
  </div>
</div>


{%include 'partials/footer.html'%}

<script src="{%static 'js/list.js' %}"></script>
</body>
</html>

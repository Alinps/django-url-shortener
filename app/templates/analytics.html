<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <title>Analytics</title>
  <link rel="stylesheet" href="{% static 'css/analytics.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="analytics-container">

    <!-- Header -->
    <div class="analytics-header">
      <div>
        <h2>{{ url.title }}</h2>
        <p class="subtitle">Link analytics overview</p>
      </div>
      <a href="{% url 'list' %}" class="back-link">← Back</a>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <span class="stat-label">Total Clicks</span>
        <span class="stat-value">{{ total_clicks }}</span>
      </div>

      <div class="stat-card">
        <span class="stat-label">Last Clicked</span>
        <span class="stat-value">
          {% if last_click %}
            {{ last_click|timesince }} ago
          {% else %}
            Never
          {% endif %}
        </span>
      </div>

      <div class="stat-card">
        <span class="stat-label">Status</span>
        <span class="stat-value {% if url.is_active %}active{% else %}disabled{% endif %}">
          {% if url.is_active %}Active{% else %}Disabled{% endif %}
        </span>
      </div>
    </div>

  <div class="range-selector">
  <a href="?range=7"
     class="range-btn {% if current_range == '7' %}active{% endif %}">
    Last 7 days
  </a>

  <a href="?range=30"
     class="range-btn {% if current_range == '30' %}active{% endif %}">
    Last 30 days
  </a>

  <a href="?range=all"
     class="range-btn {% if current_range == 'all' %}active{% endif %}">
    All time
  </a>

  <form method="get" class="date-range-form">
    <input type="date" name="start" value="{{ start }}">
    <input type="date" name="end" value="{{ end }}">
    <button type="submit">Apply</button>
  </form>


</div>


    <!-- Chart -->
    <div class="analytics-card">
      <div class="chart-header">
        <h3>Clicks Over Time</h3>
        <span class="chart-subtitle">Daily engagement</span>
      </div>
      <canvas id="clickChart"></canvas>
    </div>

  </div>

  <script>
    const ctx = document.getElementById("clickChart");

    new Chart(ctx, {
      type: "line",
      data: {
        labels: {{ days|safe }},
        datasets: [{
          data: {{ counts|safe }},
          borderColor: "#60a5fa",
          backgroundColor: "rgba(96,165,250,0.15)",
          tension: 0.35,
          fill: true,
          pointRadius: 3,
          pointHoverRadius: 6,
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          x: {
            grid: { display: false },
            ticks: { color: "#9ca3af" }
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: "#9ca3af",
              precision: 0
            }
          }
        }
      }
    });
  </script>
<div class="analytics-card">
  <h3>Device Breakdown</h3>

  {% for item in device_stats %}
    <p>
      {{ item.device_type|title }} — {{ item.count }}
    </p>
  {% empty %}
    <p>No device data available</p>
  {% endfor %}
</div>

</body>
</html>
